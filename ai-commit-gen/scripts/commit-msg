#!/usr/bin/env bash

# Git commit-msg hook to generate a commit message using the Java tool.
# This script is installed into .git/hooks/commit-msg by install-hooks.sh

set -euo pipefail

COMMIT_MSG_FILE="$1"

# The install script will copy the fat jar here
JAR_PATH="$(git rev-parse --show-toplevel)/.git/hooks/ai-commit-gen.jar"

if [ ! -f "$JAR_PATH" ]; then
  echo "[ai-commit-gen] JAR not found at $JAR_PATH. Skipping generation." >&2
  exit 0
fi

# Find java
JAVA_BIN="$(command -v java || true)"
if [ -z "$JAVA_BIN" ] && [ -n "${JAVA_HOME:-}" ]; then
  JAVA_BIN="$JAVA_HOME/bin/java"
fi
if [ -z "$JAVA_BIN" ] || [ ! -x "$JAVA_BIN" ]; then
  echo "[ai-commit-gen] java not found on PATH or JAVA_HOME. Skipping generation." >&2
  exit 0
fi

# Execute the tool. It is safe and will never block commit even if it fails.
"$JAVA_BIN" -jar "$JAR_PATH" "$COMMIT_MSG_FILE" || true

exit 0

